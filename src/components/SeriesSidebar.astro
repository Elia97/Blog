---
import { getCollection } from "astro:content";

const allPosts = await getCollection("blog");
const uniqueSeries = [
  ...new Set(allPosts.map((post) => post.data.series).filter(Boolean)),
];

interface Props {
  currentSeries?: string;
}

const { currentSeries } = Astro.props;

// Filtriamo le serie per mostrare quelle correlate (per ora tutte le altre)
const otherSeries = uniqueSeries.filter((s) => s !== currentSeries);
---

<aside class="series-sidebar">
  <div class="sidebar-section">
    <h4>Serie Attuale</h4>
    {
      currentSeries ? (
        <a href={`/blog#${currentSeries}`} class="current-series-link">
          <div class="current-series">{currentSeries.replace(/-/g, " ")}</div>
        </a>
      ) : (
        <p class="no-series">Nessuna serie</p>
      )
    }
  </div>

  <div class="sidebar-section">
    <h4>Altre Serie</h4>
    <ul class="series-list">
      {
        otherSeries.map((seriesName) => (
          <li>
            <a href={`/blog#${seriesName}`}>{seriesName?.replace(/-/g, " ")}</a>
          </li>
        ))
      }
      {otherSeries.length === 0 && <li class="empty">Nessuna altra serie</li>}
    </ul>
  </div>
</aside>

<style>
  .series-sidebar {
    position: fixed;
    top: 170px; /* Altezza ribassata per respiro verticale */
    left: calc(
      50% - 630px
    ); /* Riportato verso il centro per evitare overflow esterno */
    width: 220px;
    display: none;
  }

  .sidebar-section {
    margin-bottom: 2rem;
  }

  .series-sidebar h4 {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: rgb(var(--gray));
    margin-bottom: 0.75rem;
    font-weight: 700;
  }

  .current-series-link {
    text-decoration: none;
    display: block;
  }

  .current-series {
    padding: 0.5rem 0.75rem;
    background: rgba(var(--accent), 0.1);
    color: var(--accent);
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
    text-transform: capitalize;
    transition: background 0.2s;
  }

  .current-series-link:hover .current-series {
    background: rgba(var(--accent), 0.2);
  }

  .no-series,
  .empty {
    font-size: 0.85rem;
    color: rgb(var(--gray));
    font-style: italic;
  }

  .series-list {
    list-style: none;
    padding: 0;
  }

  .series-list li {
    margin-bottom: 0.25rem;
  }

  .series-list a {
    display: block;
    padding: 0.4rem 0.75rem;
    color: rgb(var(--gray-dark));
    text-decoration: none;
    font-size: 0.9rem;
    border-radius: 6px;
    transition: all 0.2s;
    text-transform: capitalize;
  }

  .series-list a:hover {
    background: rgba(var(--gray-light), 0.5);
    color: var(--accent);
  }

  @media (min-width: 1350px) {
    .series-sidebar {
      display: block;
    }
  }
</style>
